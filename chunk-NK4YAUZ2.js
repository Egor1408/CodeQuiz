import{a as J}from"./chunk-AGGNX6VP.js";import{b as G,d as H}from"./chunk-64YZE42E.js";import{Fa as P,Ka as j,Lb as U,O as N,S as F,Ua as C,Va as b,Wa as L,Y as z,Ya as S,Z as E,Za as I,a as D,b as R,c as Q,cb as l,db as c,eb as V,fb as T,ga as m,gb as $,ib as k,jb as g,lb as q,mb as d,nb as _,ob as B,pb as Y,ub as w,va as s}from"./chunk-SNAX7ZW7.js";var O=class o{constructor(n){this.questionService=n}prepareQuestions(n){return Q(this,null,function*(){let t=yield this.questionService.loadQuizData(n.languageId);if(!t)throw new Error("Failed to load quiz data");let e=t.sections.filter(f=>n.selectedSections.includes(f.id));if(e.length===0)throw new Error("No sections selected");let i=e.reduce((f,x)=>f+x.questions.length,0),a;n.questionCount==="all"?a=i:a=Math.min(n.questionCount,i);let p=Math.floor(a/e.length),M=a%e.length,v=[];return e.forEach((f,x)=>{let y=p+(x<M?1:0);this.shuffleArray([...f.questions]).slice(0,y).forEach(u=>{let h=this.shuffleArray([...u.options]);v.push(R(D({},u),{shuffledOptions:h,sectionTitle:f.title}))})}),this.shuffleArray(v)})}shuffleArray(n){let t=[...n];for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t}static \u0275fac=function(t){return new(t||o)(F(J))};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})};var Z=(o,n)=>n.id;function tt(o,n){if(o&1&&V(0,"div",9),o&2){let t=n.$implicit,e=n.$index,i=g();q("correct",t===!0)("incorrect",t===!1)("current",e===i.currentQuestionIndex()&&t===null)}}function et(o,n){if(o&1){let t=T();l(0,"button",17),k("click",function(){let i=z(t).$implicit,a=g(2);return E(a.onAnswerSelect(i.id))}),l(1,"span",18),d(2),c()()}if(o&2){let t=n.$implicit,e=g(),i=g();q("selected",i.selectedAnswerId()===t.id)("correct",i.showResult()&&t.id===e.correctAnswerId)("incorrect",i.showResult()&&i.selectedAnswerId()===t.id&&!i.isCorrect()),$("disabled",i.showResult()),s(2),_(t.text)}}function nt(o,n){o&1&&d(0," \u2713 ")}function ot(o,n){o&1&&d(0," \u2717 ")}function it(o,n){o&1&&d(0," \u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E! ")}function rt(o,n){o&1&&d(0," \u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E ")}function st(o,n){if(o&1&&(l(0,"div",19)(1,"div",20),C(2,nt,1,0)(3,ot,1,0),c(),l(4,"div",21)(5,"p",22),C(6,it,1,0)(7,rt,1,0),c(),l(8,"p",23),d(9),c()()()),o&2){let t=g(),e=g();q("correct-explanation",e.isCorrect())("incorrect-explanation",!e.isCorrect()),s(2),b(e.isCorrect()?2:3),s(4),b(e.isCorrect()?6:7),s(3),_(t.explanation)}}function at(o,n){if(o&1){let t=T();l(0,"div",16)(1,"button",24),k("click",function(){z(t);let i=g(2);return E(i.onNextQuestion())}),d(2),c()()}if(o&2){let t=g(2);s(2),B(" ",t.isLastQuestion()?"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u0430\u043C":"\u0414\u0430\u043B\u0435\u0435"," ")}}function ct(o,n){if(o&1&&(l(0,"div",8)(1,"div",10)(2,"span",11),d(3),c()(),l(4,"h2",12),d(5),c(),l(6,"div",13),S(7,et,3,8,"button",14,Z),c(),C(9,st,10,7,"div",15),C(10,at,3,1,"div",16),c()),o&2){let t=n,e=g();s(3),_(t.sectionTitle),s(2),_(t.question),s(2),I(t.shuffledOptions),s(2),b(e.showResult()&&t.explanation?9:-1),s(),b(e.showResult()?10:-1)}}var K=class o{constructor(n,t,e){this.quizService=n;this.router=t;this.route=e}questions=m([]);currentQuestionIndex=m(0);selectedAnswerId=m(null);showResult=m(!1);isCorrect=m(null);startTime=m(null);questionStartTime=m(null);answers=m([]);config=m(null);currentQuestion=w(()=>{let n=this.currentQuestionIndex();return this.questions()[n]||null});progress=w(()=>{let n=this.questions().length;return n===0?0:(this.currentQuestionIndex()+1)/n*100});isLastQuestion=w(()=>this.currentQuestionIndex()===this.questions().length-1);questionStatuses=w(()=>{let n=new Array(this.questions().length).fill(null),t=new Map;return this.answers().forEach(e=>{t.set(e.questionId,e.isCorrect)}),this.questions().forEach((e,i)=>{let a=t.get(e.id);a!==void 0&&(n[i]=a)}),n});ngOnInit(){return Q(this,null,function*(){let n=this.getConfigFromRoute();if(!n){this.router.navigate(["/"]);return}this.config.set(n);try{let t=yield this.quizService.prepareQuestions(n);this.questions.set(t),this.startTime.set(new Date),this.questionStartTime.set(new Date)}catch{this.router.navigate(["/"])}})}getConfigFromRoute(){let n=this.router.getCurrentNavigation();if(n?.extras?.state?.config)return n.extras.state.config;let t=history.state;if(t&&t.config)return t.config;let e=this.route.snapshot.queryParams;return e.languageId&&e.questionCount&&e.selectedSections?{languageId:e.languageId,questionCount:e.questionCount==="all"?"all":+e.questionCount,selectedSections:Array.isArray(e.selectedSections)?e.selectedSections:e.selectedSections.split(",")}:null}onAnswerSelect(n){if(this.showResult())return;let t=this.currentQuestion();if(!t)return;this.selectedAnswerId.set(n);let e=n===t.correctAnswerId;this.isCorrect.set(e);let i=this.questionStartTime()?Date.now()-this.questionStartTime().getTime():0,a={questionId:t.id,selectedAnswerId:n,correctAnswerId:t.correctAnswerId,isCorrect:e,timeSpent:i};this.answers.update(p=>[...p,a]),this.showResult.set(!0)}onNextQuestion(){this.isLastQuestion()?this.finishQuiz():(this.currentQuestionIndex.update(n=>n+1),this.selectedAnswerId.set(null),this.showResult.set(!1),this.isCorrect.set(null),this.questionStartTime.set(new Date))}finishQuiz(){let n=this.config();if(!n){this.router.navigate(["/"]);return}let t=this.questions().length,e=this.answers().filter(r=>r.isCorrect).length,i=t-e,a=t>0?Math.round(e/t*100):0,p=new Map;this.questions().forEach(r=>{let u=r.sectionTitle;p.has(u)||p.set(u,{title:u,total:0,correct:0});let h=p.get(u);h.total++});let M=new Map;this.answers().forEach(r=>{M.set(r.questionId,r.isCorrect)}),this.questions().forEach(r=>{let u=M.get(r.id);if(u!==void 0){let h=p.get(r.sectionTitle);h&&u&&h.correct++}});let v=[];p.forEach((r,u)=>{v.push({sectionId:u,sectionTitle:r.title,totalQuestions:r.total,correctAnswers:r.correct,incorrectAnswers:r.total-r.correct,percentage:r.total>0?Math.round(r.correct/r.total*100):0})});let f=new Date,x=this.startTime(),y=x?f.getTime()-x.getTime():0,A={languageId:n.languageId,totalQuestions:t,correctAnswers:e,incorrectAnswers:i,percentage:a,answers:this.answers(),sectionStatistics:v,startTime:x||new Date,endTime:f,duration:y};this.router.navigate(["/results"],{state:{result:A}})}static \u0275fac=function(t){return new(t||o)(P(O),P(H),P(G))};static \u0275cmp=j({type:o,selectors:[["app-quiz"]],decls:11,vars:3,consts:[[1,"quiz-container"],[1,"quiz-content"],[1,"progress-section"],[1,"progress-info"],[1,"question-counter"],[1,"progress-bar-wrapper"],[1,"progress-segments"],[1,"progress-segment",3,"correct","incorrect","current"],[1,"question-card"],[1,"progress-segment"],[1,"question-header"],[1,"section-badge"],[1,"question-text"],[1,"options-list"],[1,"option-button",3,"selected","correct","incorrect","disabled"],[1,"explanation",3,"correct-explanation","incorrect-explanation"],[1,"action-buttons"],[1,"option-button",3,"click","disabled"],[1,"option-text"],[1,"explanation"],[1,"explanation-icon"],[1,"explanation-text"],[1,"explanation-title"],[1,"explanation-content"],[1,"button","button-primary","next-button",3,"click"]],template:function(t,e){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),d(5),c()(),l(6,"div",5)(7,"div",6),S(8,tt,1,6,"div",7,L),c()()(),C(10,ct,11,4,"div",8),c()()),t&2){let i;s(5),Y(" \u0412\u043E\u043F\u0440\u043E\u0441 ",e.currentQuestionIndex()+1," \u0438\u0437 ",e.questions().length," "),s(3),I(e.questionStatuses()),s(2),b((i=e.currentQuestion())?10:-1,i)}},dependencies:[U],styles:[".quiz-container[_ngcontent-%COMP%]{min-height:100vh;padding:2rem 1rem;background:var(--page-bg)}.quiz-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.progress-section[_ngcontent-%COMP%]{margin-bottom:2rem}.progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.question-counter[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--text-secondary)}.progress-bar-wrapper[_ngcontent-%COMP%]{width:100%;height:8px;background:var(--input-bg);border-radius:4px;overflow:hidden}.progress-segments[_ngcontent-%COMP%]{display:flex;height:100%;width:100%;gap:2px}.progress-segment[_ngcontent-%COMP%]{flex:1;height:100%;background:var(--input-bg);transition:background-color .3s ease;border-radius:2px}.progress-segment.correct[_ngcontent-%COMP%]{background:var(--success-color)}.progress-segment.incorrect[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--error-color) 70%,var(--input-bg))}.progress-segment.current[_ngcontent-%COMP%]{background:var(--border-color)}.question-card[_ngcontent-%COMP%]{background:var(--card-bg);border-radius:1rem;padding:2rem;box-shadow:0 4px 6px var(--shadow-color);border:1px solid var(--border-color)}.question-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.section-badge[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;background:color-mix(in srgb,var(--primary-color) 15%,transparent);color:var(--primary-color);border-radius:.5rem;font-size:.875rem;font-weight:600}.question-text[_ngcontent-%COMP%]{margin:0 0 2rem;font-size:1.5rem;font-weight:600;color:var(--text-primary);line-height:1.5}.options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2rem}.option-button[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1.25rem 1.5rem;background:var(--input-bg);border:2px solid var(--border-color);border-radius:.75rem;cursor:pointer;transition:all .3s ease;text-align:left;font-size:1rem;color:var(--text-primary);width:100%}.option-button[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary-color);background:color-mix(in srgb,var(--primary-color) 5%,var(--input-bg));transform:translate(4px)}.option-button[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.option-button.selected[_ngcontent-%COMP%]{border-color:var(--primary-color);background:color-mix(in srgb,var(--primary-color) 10%,var(--input-bg))}.option-button.correct[_ngcontent-%COMP%]{border-color:var(--success-color);background:color-mix(in srgb,var(--success-color) 15%,var(--input-bg));color:var(--success-color);font-weight:600}.option-button.incorrect[_ngcontent-%COMP%]{border-color:color-mix(in srgb,var(--error-color) 60%,var(--border-color));background:color-mix(in srgb,var(--error-color) 8%,var(--input-bg));color:color-mix(in srgb,var(--error-color) 70%,var(--text-primary));font-weight:600}.option-text[_ngcontent-%COMP%]{line-height:1.5;width:100%}.explanation[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1.5rem;border-radius:.75rem;margin-bottom:2rem;animation:_ngcontent-%COMP%_slideIn .3s ease}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.explanation.correct-explanation[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success-color) 15%,var(--card-bg));border:2px solid var(--success-color)}.explanation.incorrect-explanation[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--error-color) 8%,var(--card-bg));border:2px solid color-mix(in srgb,var(--error-color) 60%,var(--border-color))}.explanation-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;font-size:1.5rem;font-weight:700;flex-shrink:0}.correct-explanation[_ngcontent-%COMP%]   .explanation-icon[_ngcontent-%COMP%]{background:var(--success-color);color:#fff}.incorrect-explanation[_ngcontent-%COMP%]   .explanation-icon[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--error-color) 80%,var(--border-color));color:#fff}.explanation-text[_ngcontent-%COMP%]{flex:1}.explanation-title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.125rem;font-weight:700}.correct-explanation[_ngcontent-%COMP%]   .explanation-title[_ngcontent-%COMP%]{color:var(--success-color)}.incorrect-explanation[_ngcontent-%COMP%]   .explanation-title[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--error-color) 70%,var(--text-primary))}.explanation-content[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:var(--text-primary);line-height:1.6}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.button[_ngcontent-%COMP%]{padding:.875rem 2rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease}.button-primary[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff}.button-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary-hover);transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.button-primary[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.button-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.quiz-container[_ngcontent-%COMP%]{padding:1rem .5rem}.question-card[_ngcontent-%COMP%]{padding:1.5rem}.question-text[_ngcontent-%COMP%]{font-size:1.25rem}.option-button[_ngcontent-%COMP%]{padding:1rem 1.25rem}}"]})};export{K as QuizComponent};
